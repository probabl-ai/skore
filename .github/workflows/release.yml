name: Release
on:
  release:
    types: [released, prereleased]

jobs:
  release:
    name: Build distribution archives and publish to PyPI
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      #
      # - name: Set up Node 20
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: 20
      # - name: Build frontend and share library
      #   run: |
      #     cd frontend
      #     npm run build
      #     cp -a dist/. ../src/mandr/dashboard/static
      #     npm run build:lib
      #     cp -a dist/. ../src/mandr/dashboard/static
      #     rm -rf frontend/dist
      #
      - name: Create VERSION.txt
        run: |
          echo "${GITHUB_REF_NAME:1}" > VERSION.txt
      #
      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Build sdist and wheel
        run: |
          python -m pip install build
          python -m build
      # - name: Publish to PyPI
      #   run: |
      #     python -m pip install twine
      #     python -m twine upload --repository testpypi dist/*
